# Migration Guide: v4.0 Tool Splitting

## Overview

Version 4.0.0 introduces a major architectural change: the monolithic `deepthinking` tool has been split into 9 focused tools for improved token efficiency and better separation of concerns.

## Breaking Changes

### Tool Structure

**Before (v3.x):** Single tool with all 18 modes
```json
{
  "name": "deepthinking",
  "inputSchema": { /* ~1100 lines */ }
}
```

**After (v4.0):** 9 focused tools
```json
{
  "tools": [
    "deepthinking_core",        // sequential, shannon, hybrid
    "deepthinking_mathematics", // mathematics, physics
    "deepthinking_temporal",    // temporal
    "deepthinking_probabilistic", // bayesian, evidential
    "deepthinking_causal",      // causal, counterfactual, abductive
    "deepthinking_strategic",   // gametheory, optimization
    "deepthinking_analytical",  // analogical, firstprinciples
    "deepthinking_scientific",  // scientificmethod, systemsthinking, formallogic
    "deepthinking_session"      // summarize, export, get_session, switch_mode, recommend_mode
  ]
}
```

## Token Reduction

| Metric | v3.x | v4.0 | Reduction |
|--------|------|------|-----------|
| Total tokens | ~8-10K | ~3-4K | **60%** |
| Schema lines | 1,136 | ~400 | **65%** |
| Schema sources | 2 (Zod + JSON) | 1 (Zod) | Single source |

## Mode to Tool Mapping

| Mode(s) | New Tool |
|---------|----------|
| `sequential`, `shannon`, `hybrid` | `deepthinking_core` |
| `mathematics`, `physics` | `deepthinking_mathematics` |
| `temporal` | `deepthinking_temporal` |
| `bayesian`, `evidential` | `deepthinking_probabilistic` |
| `causal`, `counterfactual`, `abductive` | `deepthinking_causal` |
| `gametheory`, `optimization` | `deepthinking_strategic` |
| `analogical`, `firstprinciples` | `deepthinking_analytical` |
| `scientificmethod`, `systemsthinking`, `formallogic` | `deepthinking_scientific` |
| Session actions | `deepthinking_session` |

## Backward Compatibility

The original `deepthinking` tool remains available but is **deprecated**. It automatically routes to the appropriate new tool based on the `mode` parameter.

### Deprecation Timeline

- **v4.0.0**: `deepthinking` deprecated, routes to new tools with warnings
- **v5.0.0**: `deepthinking` will be removed

### Migration Steps

1. **Identify which modes you use**
   - Check your existing `deepthinking` calls for the `mode` parameter

2. **Update tool names**
   ```javascript
   // Before
   await client.callTool('deepthinking', { mode: 'mathematics', ... });

   // After
   await client.callTool('deepthinking_mathematics', { mode: 'mathematics', ... });
   ```

3. **Session operations**
   ```javascript
   // Before
   await client.callTool('deepthinking', { action: 'summarize', sessionId: '...' });

   // After
   await client.callTool('deepthinking_session', { action: 'summarize', sessionId: '...' });
   ```

## Examples

### Core Reasoning (Sequential, Shannon, Hybrid)

```javascript
// Using deepthinking_core
await client.callTool('deepthinking_core', {
  mode: 'sequential',
  thought: 'Step 1: Analyze the problem',
  thoughtNumber: 1,
  totalThoughts: 5,
  nextThoughtNeeded: true
});
```

### Mathematics/Physics

```javascript
// Using deepthinking_mathematics
await client.callTool('deepthinking_mathematics', {
  mode: 'mathematics',
  thought: 'Proving by induction',
  thoughtNumber: 1,
  totalThoughts: 3,
  nextThoughtNeeded: true,
  proofStrategy: {
    type: 'induction',
    steps: ['Base case', 'Inductive step']
  }
});
```

### Temporal Reasoning

```javascript
// Using deepthinking_temporal
await client.callTool('deepthinking_temporal', {
  mode: 'temporal',
  thought: 'Analyzing event sequence',
  thoughtNumber: 1,
  totalThoughts: 4,
  nextThoughtNeeded: true,
  timeline: {
    id: 'timeline-1',
    name: 'Project Timeline',
    timeUnit: 'days',
    events: ['start', 'milestone', 'end']
  }
});
```

### Session Management

```javascript
// Using deepthinking_session
await client.callTool('deepthinking_session', {
  action: 'export',
  sessionId: 'session-123',
  exportFormat: 'markdown'
});
```

## FAQ

### Q: Can I still use the old `deepthinking` tool?

Yes, but it's deprecated. It will emit warnings and route to the appropriate new tool. Plan to migrate before v5.0.0.

### Q: Do I need to update my session IDs?

No, session IDs are compatible across all tools. You can start a session with one tool and continue with another.

### Q: Are the input schemas different?

The core properties (`thought`, `thoughtNumber`, etc.) are the same. Mode-specific properties are now organized by tool, making each tool's schema smaller and more focused.

### Q: How does lazy loading work?

Schemas are loaded on-demand when a tool is first used. This reduces startup time and memory usage.

## Support

If you encounter issues during migration, please:
1. Check this guide for common patterns
2. Review the [CHANGELOG](../../CHANGELOG.md) for detailed changes
3. Open an issue on GitHub with the `migration` label
