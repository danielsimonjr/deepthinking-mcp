{
  "phase": 13,
  "sprint": 1,
  "title": "Infrastructure & Builder Classes",
  "week": "Week 1",
  "effort": "4-6 hours",
  "status": "pending",
  "description": "Add builder pattern classes to DOT and Mermaid utility modules to enable fluent API for graph construction, with comprehensive unit tests",
  "tasks": [
    {
      "id": "13.1.1",
      "category": "DOT Builder",
      "description": "Add DOTGraphBuilder class to utils/dot.ts",
      "status": "pending",
      "estimatedHours": 2.0,
      "details": [
        "Create DOTGraphBuilder class with fluent API",
        "Implement addNode(node: DotNode): this method",
        "Implement addEdge(edge: DotEdge): this method",
        "Implement addSubgraph(subgraph: DotSubgraph): this method",
        "Implement setOptions(options: DotOptions): this method",
        "Implement render(): string method using existing generateDotGraph()",
        "Add DotSubgraph interface if not present",
        "Export DOTGraphBuilder from utils/dot.ts"
      ],
      "files": [
        "src/export/visual/utils/dot.ts"
      ],
      "notes": "The builder wraps existing functionality (generateDotGraph, renderDotNode, etc.) to provide a cleaner API for mode exporters"
    },
    {
      "id": "13.1.2",
      "category": "Mermaid Builder",
      "description": "Add MermaidGraphBuilder class to utils/mermaid.ts (optional enhancement)",
      "status": "pending",
      "estimatedHours": 1.5,
      "details": [
        "Create MermaidGraphBuilder class with fluent API",
        "Implement addNode(node: MermaidNode): this method",
        "Implement addEdge(edge: MermaidEdge): this method",
        "Implement addSubgraph(id: string, label: string, nodes: MermaidNode[]): this method",
        "Implement setOptions(options: MermaidOptions): this method",
        "Implement render(): string method using existing generateMermaidFlowchart()",
        "Export MermaidGraphBuilder from utils/mermaid.ts"
      ],
      "files": [
        "src/export/visual/utils/mermaid.ts"
      ],
      "notes": "Optional enhancement - mode exporters can use existing functions directly. Builder provides consistency with DOT approach"
    },
    {
      "id": "13.1.3",
      "category": "Unit Tests",
      "description": "Write comprehensive unit tests for new builder classes",
      "status": "pending",
      "estimatedHours": 2.0,
      "details": [
        "Create tests/unit/export/visual/utils/dot-builder.test.ts",
        "Test DOTGraphBuilder node addition and rendering",
        "Test DOTGraphBuilder edge addition with various styles",
        "Test DOTGraphBuilder subgraph support",
        "Test DOTGraphBuilder options (rankDir, splines, etc.)",
        "Create tests/unit/export/visual/utils/mermaid-builder.test.ts",
        "Test MermaidGraphBuilder with various node shapes",
        "Test MermaidGraphBuilder subgraph rendering",
        "Verify builder output matches existing function output"
      ],
      "files": [
        "tests/unit/export/visual/utils/dot-builder.test.ts",
        "tests/unit/export/visual/utils/mermaid-builder.test.ts"
      ],
      "notes": "Tests should verify that builder output is equivalent to direct function calls"
    },
    {
      "id": "13.1.4",
      "category": "Documentation",
      "description": "Update utility module documentation with builder usage examples",
      "status": "pending",
      "estimatedHours": 0.5,
      "details": [
        "Add JSDoc comments to DOTGraphBuilder class and methods",
        "Add JSDoc comments to MermaidGraphBuilder class and methods",
        "Include usage examples in JSDoc @example tags",
        "Document the before/after refactoring pattern"
      ],
      "files": [
        "src/export/visual/utils/dot.ts",
        "src/export/visual/utils/mermaid.ts"
      ],
      "notes": "Documentation helps future maintainers understand the utility adoption pattern"
    }
  ],
  "successCriteria": [
    "DOTGraphBuilder class is exported and functional",
    "MermaidGraphBuilder class is exported and functional",
    "All builder unit tests pass",
    "Builder output is equivalent to direct function calls",
    "No breaking changes to existing utility exports"
  ],
  "filesCreated": [
    "tests/unit/export/visual/utils/dot-builder.test.ts",
    "tests/unit/export/visual/utils/mermaid-builder.test.ts"
  ],
  "filesModified": [
    "src/export/visual/utils/dot.ts",
    "src/export/visual/utils/mermaid.ts"
  ],
  "totalEstimatedHours": 6.0,
  "notes": "Infrastructure sprint - creates the builder classes that will be used in Sprint 2 to refactor the 12 critical files. The builder pattern is optional but recommended for cleaner code."
}
