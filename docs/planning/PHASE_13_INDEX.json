{
  "phase": 13,
  "title": "Visual Exporter Refactoring",
  "description": "Comprehensive utility module adoption - adding fluent API builder classes to ALL 11 utility modules and refactoring ALL 22 mode exporters to use them. File size reduction below 1000 lines is a natural consequence of this modular approach.",
  "totalSprints": 10,
  "totalTasks": 46,
  "totalEstimatedHours": 67,
  "status": "in-progress",
  "sprints": [
    {
      "sprint": 1,
      "title": "Core Graph Builders",
      "focus": "DOTGraphBuilder, MermaidGraphBuilder, GraphMLBuilder + unit tests",
      "tasks": 4,
      "hours": 5.5,
      "file": "PHASE_13_SPRINT_1_TODO.json",
      "status": "completed",
      "completedDate": "2025-12-26",
      "actualTests": 64
    },
    {
      "sprint": 2,
      "title": "Visual Format Builders",
      "focus": "ASCIIDocBuilder, SVGBuilder, TikZBuilder + unit tests",
      "tasks": 4,
      "hours": 6,
      "file": "PHASE_13_SPRINT_2_TODO.json",
      "status": "completed",
      "completedDate": "2025-12-26",
      "actualTests": 89
    },
    {
      "sprint": 3,
      "title": "Document Format Builders",
      "focus": "UMLBuilder, HTMLDocBuilder, MarkdownBuilder, ModelicaBuilder, JSONExportBuilder + unit tests",
      "tasks": 5,
      "hours": 5.5,
      "file": "PHASE_13_SPRINT_3_TODO.json",
      "status": "completed",
      "completedDate": "2025-12-26",
      "actualTests": 115
    },
    {
      "sprint": 4,
      "title": "Builder Integration & Testing",
      "focus": "JSDoc, index exports, integration tests, baseline snapshot generation",
      "tasks": 4,
      "hours": 5.5,
      "file": "PHASE_13_SPRINT_4_TODO.json",
      "status": "completed",
      "completedDate": "2025-12-26",
      "actualTests": 113,
      "notes": "35 integration tests + 63 snapshot baseline tests + 15 mode exporter snapshots = 113 tests created"
    },
    {
      "sprint": 5,
      "title": "Critical Files Batch 1 - Largest",
      "focus": "physics.ts, engineering.ts, metareasoning.ts, proof-decomposition.ts + snapshot verification",
      "tasks": 5,
      "hours": 11,
      "file": "PHASE_13_SPRINT_5_TODO.json",
      "status": "partial",
      "completedDate": "2025-12-26",
      "notes": "BUILDER ADOPTION COMPLETE but FILE SIZE TARGETS NOT MET. All 4 files use builders but remain >1000 lines. physics.ts: 1724, engineering.ts: 1706, metareasoning.ts: 1593, proof-decomposition.ts: 1513. File splitting deferred to Sprint 10."
    },
    {
      "sprint": 6,
      "title": "Critical Files Batch 2",
      "focus": "hybrid.ts, formal-logic.ts, scientific-method.ts, optimization.ts + snapshot verification",
      "tasks": 5,
      "hours": 9,
      "file": "PHASE_13_SPRINT_6_TODO.json",
      "status": "completed",
      "completedDate": "2025-12-26",
      "notes": "BUILDER ADOPTION COMPLETE. 4 files refactored, 12 snapshots updated, 4686 tests passing."
    },
    {
      "sprint": 7,
      "title": "Critical Files Batch 3",
      "focus": "first-principles.ts, mathematics.ts, game-theory.ts, evidential.ts + snapshot verification",
      "tasks": 5,
      "hours": 8,
      "file": "PHASE_13_SPRINT_7_TODO.json",
      "status": "completed",
      "completedDate": "2025-12-26",
      "notes": "BUILDER ADOPTION COMPLETE. 4 files refactored, 12 snapshots updated, 4686 tests passing."
    },
    {
      "sprint": 8,
      "title": "Remaining Modes Batch 1",
      "focus": "systems-thinking.ts, analogical.ts, causal.ts, computability.ts, counterfactual.ts + snapshot verification",
      "tasks": 5,
      "hours": 7,
      "file": "PHASE_13_SPRINT_8_TODO.json",
      "status": "completed",
      "completedDate": "2025-12-26",
      "notes": "BUILDER ADOPTION COMPLETE. 5 files refactored, 13 snapshots updated, 4686 tests passing. Turing machine state diagrams kept as raw strings."
    },
    {
      "sprint": 9,
      "title": "Remaining Modes Batch 2 - COMPLETE",
      "focus": "sequential.ts, abductive.ts, bayesian.ts, temporal.ts, shannon.ts + snapshot & adoption verification",
      "tasks": 5,
      "hours": 5.5,
      "file": "PHASE_13_SPRINT_9_TODO.json",
      "status": "completed",
      "completedDate": "2025-12-26",
      "notes": "BUILDER ADOPTION COMPLETE. Added MermaidGanttBuilder and MermaidStateDiagramBuilder. Refactored temporal.ts to use GanttBuilder, computability.ts to use StateDiagramBuilder. TRUE 100% builder adoption - NO exceptions. 22/22 (100%) mode exporters now use builders."
    },
    {
      "sprint": 10,
      "title": "File Splitting & Final Cleanup",
      "focus": "Analysis, file splitting if needed, final testing, documentation",
      "tasks": 4,
      "hours": 4.5,
      "file": "PHASE_13_SPRINT_10_TODO.json",
      "status": "pending",
      "notes": "Sprint 10 now CRITICAL for file splitting - Sprint 5 files still >1000 lines"
    }
  ],
  "features": {
    "R-1": { "name": "DOT Builder & Adoption", "sprints": [1, 5, 6, 7, 8, 9], "status": "completed", "priority": "high", "notes": "Builder complete, 22/22 modes adopted (100%)" },
    "R-2": { "name": "Mermaid Builder & Adoption", "sprints": [1, 5, 6, 7, 8, 9], "status": "completed", "priority": "high", "notes": "Builder complete + MermaidGanttBuilder + MermaidStateDiagramBuilder. 22/22 modes adopted (100%). NO exceptions." },
    "R-3": { "name": "ASCII Builder & Adoption", "sprints": [2, 5, 6, 7, 8, 9], "status": "completed", "priority": "high", "notes": "Builder complete, 22/22 modes adopted (100%)" },
    "R-4": { "name": "SVG Builder", "sprints": [2], "status": "completed", "priority": "medium" },
    "R-5": { "name": "GraphML Builder", "sprints": [1], "status": "completed", "priority": "medium" },
    "R-6": { "name": "TikZ Builder", "sprints": [2], "status": "completed", "priority": "medium" },
    "R-7": { "name": "UML Builder", "sprints": [3], "status": "completed", "priority": "medium" },
    "R-8": { "name": "HTML Builder", "sprints": [3], "status": "completed", "priority": "medium" },
    "R-9": { "name": "Markdown Builder", "sprints": [3], "status": "completed", "priority": "medium" },
    "R-10": { "name": "Modelica Builder", "sprints": [3], "status": "completed", "priority": "low" },
    "R-11": { "name": "JSON Builder", "sprints": [3], "status": "completed", "priority": "low" },
    "R-12": { "name": "File Splitting", "sprints": [10], "status": "pending", "priority": "high", "notes": "CRITICAL - 4 files from Sprint 5 need splitting" }
  },
  "targetMetrics": {
    "dotUtilityAdoption": { "current": "22/22 (100%)", "target": "22/22 (100%)", "status": "ACHIEVED" },
    "mermaidUtilityAdoption": { "current": "22/22 (100%)", "target": "22/22 (100%)", "status": "ACHIEVED" },
    "asciiUtilityAdoption": { "current": "22/22 (100%)", "target": "22/22 (100%)", "status": "ACHIEVED" },
    "filesOver1000Lines": { "current": 12, "target": 0, "notes": "Sprint 5-9 did not reduce file sizes - files still >1000 lines" },
    "totalModeFileLines": { "current": 23864, "target": "18000-19000", "notes": "Minimal reduction from builder adoption" },
    "builderClassesAdded": { "current": 14, "target": 11, "notes": "11 primary + SVGGroupBuilder + MermaidGanttBuilder + MermaidStateDiagramBuilder" },
    "modeExportersRefactored": { "current": 22, "target": 22, "status": "ACHIEVED", "notes": "All 22 mode exporters now use builders" }
  },
  "criticalFiles": [
    { "file": "physics.ts", "lines": 1724, "originalLines": 1781, "target": "<1000", "sprint": 5, "status": "refactored-oversized", "reduction": "3%" },
    { "file": "engineering.ts", "lines": 1706, "originalLines": 1691, "target": "<1000", "sprint": 5, "status": "refactored-oversized", "reduction": "-1%" },
    { "file": "metareasoning.ts", "lines": 1593, "originalLines": 1628, "target": "<1000", "sprint": 5, "status": "refactored-oversized", "reduction": "2%" },
    { "file": "proof-decomposition.ts", "lines": 1513, "originalLines": 1624, "target": "<1000", "sprint": 5, "status": "refactored-oversized", "reduction": "7%" },
    { "file": "hybrid.ts", "lines": 1435, "target": "<1000", "sprint": 6, "status": "refactored-oversized" },
    { "file": "formal-logic.ts", "lines": 1296, "target": "<1000", "sprint": 6, "status": "refactored-oversized" },
    { "file": "scientific-method.ts", "lines": 1272, "target": "<1000", "sprint": 6, "status": "refactored-oversized" },
    { "file": "optimization.ts", "lines": 1250, "target": "<1000", "sprint": 6, "status": "refactored-oversized" },
    { "file": "first-principles.ts", "lines": 1208, "target": "<1000", "sprint": 7, "status": "refactored-oversized" },
    { "file": "mathematics.ts", "lines": 1200, "target": "<1000", "sprint": 7, "status": "refactored-oversized" },
    { "file": "game-theory.ts", "lines": 1037, "target": "<1000", "sprint": 7, "status": "refactored-oversized" },
    { "file": "evidential.ts", "lines": 1028, "target": "<1000", "sprint": 7, "status": "refactored-oversized" }
  ],
  "remainingModes": [
    { "file": "systems-thinking.ts", "lines": 911, "sprint": 8, "status": "refactored" },
    { "file": "analogical.ts", "lines": 888, "sprint": 8, "status": "refactored" },
    { "file": "causal.ts", "lines": 870, "sprint": 8, "status": "refactored" },
    { "file": "computability.ts", "lines": 825, "sprint": 8, "status": "refactored", "notes": "Sprint 9 fix: Now uses MermaidStateDiagramBuilder for Turing machines. TRUE 100% builder adoption." },
    { "file": "counterfactual.ts", "lines": 825, "sprint": 8, "status": "refactored" },
    { "file": "sequential.ts", "lines": 785, "sprint": 9, "status": "refactored", "notes": "Fixed incorrect claim - now uses builders" },
    { "file": "abductive.ts", "lines": 705, "sprint": 9, "status": "refactored" },
    { "file": "bayesian.ts", "lines": 669, "sprint": 9, "status": "refactored" },
    { "file": "temporal.ts", "lines": 635, "sprint": 9, "status": "refactored", "notes": "Now uses MermaidGanttBuilder for timeline gantt charts. TRUE 100% builder adoption." },
    { "file": "shannon.ts", "lines": 607, "sprint": 9, "status": "refactored" }
  ],
  "utilityModules": {
    "dot": { "path": "src/export/visual/utils/dot.ts", "lines": 978, "builder": "DOTGraphBuilder", "sprint": 1, "builderStatus": "completed" },
    "mermaid": { "path": "src/export/visual/utils/mermaid.ts", "lines": 1302, "builder": "MermaidGraphBuilder + MermaidGanttBuilder + MermaidStateDiagramBuilder", "sprint": 1, "builderStatus": "completed" },
    "graphml": { "path": "src/export/visual/utils/graphml.ts", "lines": 642, "builder": "GraphMLBuilder", "sprint": 1, "builderStatus": "completed" },
    "ascii": { "path": "src/export/visual/utils/ascii.ts", "lines": 1073, "builder": "ASCIIDocBuilder", "sprint": 2, "builderStatus": "completed" },
    "svg": { "path": "src/export/visual/utils/svg.ts", "lines": 1198, "builder": "SVGBuilder + SVGGroupBuilder", "sprint": 2, "builderStatus": "completed" },
    "tikz": { "path": "src/export/visual/utils/tikz.ts", "lines": 938, "builder": "TikZBuilder", "sprint": 2, "builderStatus": "completed" },
    "uml": { "path": "src/export/visual/utils/uml.ts", "lines": 929, "builder": "UMLBuilder", "sprint": 3, "builderStatus": "completed" },
    "html": { "path": "src/export/visual/utils/html.ts", "lines": 627, "builder": "HTMLDocBuilder", "sprint": 3, "builderStatus": "completed" },
    "markdown": { "path": "src/export/visual/utils/markdown.ts", "lines": 714, "builder": "MarkdownBuilder", "sprint": 3, "builderStatus": "completed" },
    "modelica": { "path": "src/export/visual/utils/modelica.ts", "lines": 520, "builder": "ModelicaBuilder", "sprint": 3, "builderStatus": "completed" },
    "json": { "path": "src/export/visual/utils/json.ts", "lines": 800, "builder": "JSONExportBuilder", "sprint": 3, "builderStatus": "completed" }
  },
  "excludedModules": [
    { "file": "latex.ts", "lines": 1284, "reason": "Large specialized module - defer to separate effort" },
    { "file": "latex-mermaid-integration.ts", "lines": 347, "reason": "Integration helper - not a primary utility" }
  ],
  "referenceImplementation": "src/export/visual/modes/hybrid.ts",
  "successCriteria": [
    "All 11 builder classes implemented and exported",
    "All builders follow consistent fluent API pattern",
    "All 22 mode exporters use builders",
    "All mode files <1000 lines",
    "All 4,686+ tests pass",
    "268+ new builder unit tests pass",
    "Visual output identical before/after"
  ],
  "risks": [
    { "risk": "Breaking visual output", "impact": "HIGH", "mitigation": "Snapshot tests for all formats" },
    { "risk": "Regression in specific modes", "impact": "MEDIUM", "mitigation": "Per-mode integration tests" },
    { "risk": "Builder pattern overhead", "impact": "LOW", "mitigation": "Benchmark performance" },
    { "risk": "Scope creep", "impact": "MEDIUM", "mitigation": "Strict task boundaries" },
    { "risk": "File size targets not achievable with builder adoption alone", "impact": "HIGH", "mitigation": "File splitting in Sprint 10", "status": "REALIZED in Sprint 5" }
  ],
  "outOfScope": [
    "JSON schemas splitting (src/tools/json-schemas.ts)",
    "src/taxonomy/suggestion-engine.ts refactoring",
    "src/services/ThoughtFactory.ts changes",
    "src/export/visual/utils/latex.ts changes"
  ],
  "dependencies": [],
  "notes": "Phase 13 restructured into 10 sprints with 4-5 tasks each. Sprints 1-4 build infrastructure (11 builders). Sprints 5-8 refactor 17 mode exporters. Sprint 9 COMPLETE: refactored 5 remaining modes (sequential, abductive, bayesian, temporal, shannon). 100% BUILDER ADOPTION ACHIEVED (22/22 mode exporters). Sprint 10 handles cleanup and file splitting. POST-SPRINT 9 UPDATE: Builder adoption complete but file sizes still exceed 1000 lines. Sprint 10 file splitting remains CRITICAL for achieving file size targets."
}
