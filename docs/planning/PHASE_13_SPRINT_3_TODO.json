{
  "phase": 13,
  "sprint": 3,
  "title": "File Splitting & Cleanup",
  "week": "Week 4",
  "effort": "8-12 hours",
  "status": "pending",
  "description": "Split any files still exceeding 1000 lines after utility adoption, update imports throughout codebase, and perform final integration testing",
  "tasks": [
    {
      "id": "13.3.1",
      "category": "Analysis",
      "description": "Identify files still exceeding 1000 lines after utility adoption",
      "status": "pending",
      "estimatedHours": 1.0,
      "details": [
        "Run line count analysis on all 12 refactored files",
        "Identify any files still >1000 lines",
        "Document which files need splitting",
        "Plan split strategy per file (by format category)",
        "Create list of new subdirectories needed"
      ],
      "files": [],
      "notes": "This task determines scope of remaining work. If all files are <1000 lines after Sprint 2, this sprint may be shorter."
    },
    {
      "id": "13.3.2",
      "category": "File Splitting",
      "description": "Split remaining large files into format-category subdirectories",
      "status": "pending",
      "estimatedHours": 6.0,
      "details": [
        "For each file still >1000 lines, create subdirectory structure:",
        "  src/export/visual/modes/{mode}/index.ts (re-exports all)",
        "  src/export/visual/modes/{mode}/visual.ts (DOT, Mermaid, ASCII, SVG)",
        "  src/export/visual/modes/{mode}/structured.ts (GraphML, TikZ, UML)",
        "  src/export/visual/modes/{mode}/document.ts (JSON, Markdown, HTML, etc.)",
        "Move functions to appropriate files based on format category",
        "Create index.ts that re-exports all functions",
        "Ensure each split file is <500 lines"
      ],
      "files": [
        "src/export/visual/modes/physics/index.ts",
        "src/export/visual/modes/physics/visual.ts",
        "src/export/visual/modes/physics/structured.ts",
        "src/export/visual/modes/physics/document.ts"
      ],
      "notes": "File list is tentative - depends on which files still exceed 1000 lines after Sprint 2. If no splitting needed, skip to task 13.3.3."
    },
    {
      "id": "13.3.3",
      "category": "Import Updates",
      "description": "Update all imports throughout codebase for split files",
      "status": "pending",
      "estimatedHours": 3.0,
      "details": [
        "Find all imports of split mode exporter files",
        "Update import paths to use new subdirectory structure",
        "Verify barrel exports (index.ts) provide same public API",
        "Run TypeScript compiler to catch any broken imports",
        "Update any tests that import mode exporters directly",
        "Update ExportService if it references split files"
      ],
      "files": [
        "src/services/ExportService.ts",
        "src/export/visual/index.ts",
        "tests/unit/export/visual/**/*.test.ts"
      ],
      "notes": "Import updates are automated if using barrel exports correctly. The public API should remain unchanged."
    },
    {
      "id": "13.3.4",
      "category": "Integration Testing",
      "description": "Final integration testing and cleanup",
      "status": "pending",
      "estimatedHours": 2.0,
      "details": [
        "Run full test suite (npm run test:run)",
        "Run typecheck (npm run typecheck)",
        "Run lint (npm run lint)",
        "Verify all 3,539+ tests pass",
        "Generate final line count report for all mode files",
        "Document final utility adoption percentages",
        "Update CLAUDE.md metrics if changed",
        "Update package.json version if needed"
      ],
      "files": [
        "CLAUDE.md",
        "package.json"
      ],
      "notes": "Final verification that refactoring is complete and no regressions introduced"
    }
  ],
  "successCriteria": [
    "All mode exporter files are <1000 lines",
    "All imports compile without errors",
    "Full test suite passes (3,539+ tests)",
    "TypeScript compilation succeeds",
    "Lint check passes",
    "DOT utility adoption: 22/22 (100%)",
    "Mermaid utility adoption: 22/22 (100%)",
    "ASCII utility adoption: 22/22 (100%)",
    "Visual output identical to pre-refactor state"
  ],
  "filesCreated": [],
  "filesModified": [
    "src/services/ExportService.ts",
    "src/export/visual/index.ts",
    "CLAUDE.md"
  ],
  "conditionalWork": {
    "trigger": "Any files still >1000 lines after Sprint 2",
    "action": "Create subdirectory structure and split files",
    "estimatedHours": "4-6 additional hours"
  },
  "totalEstimatedHours": 12.0,
  "notes": "Sprint 3 scope depends on Sprint 2 results. If all files are <1000 lines after utility adoption, this sprint focuses on import updates and final testing only (2-4 hours). If files still exceed 1000 lines, file splitting is required (full 12 hours)."
}
